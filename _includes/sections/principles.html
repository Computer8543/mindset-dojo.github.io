{%- comment -%}
Render principles referenced by a page or section.

Inputs accepted:
- include.principles (array or CSV/JSON-like string)
- section.data.principles
- page.principles

Also supports selecting a full type via:
- include.principle_type or section.data.principle_type (maps into principle_type)

Outputs:
- Calls sections/list.html with section object: { label, items }
{%- endcomment -%}

{%- assign D = section.data -%}
{%- comment -%} normalize source of requested principle ids {%- endcomment -%}
{%- assign src = section.data.principles -%}
{%- assign sel_types = section.data.principle_type -%}
{%- assign principles_data = include.page_data -%}
{%- assign matched = "" | split: "|" -%}


{%- comment -%} ensure section_types is iterable (normalize single string) {%- endcomment -%}
{%- if sel_types and sel_types[0] == nil -%}
  {%- assign sel_types = sel_types | split: ',' | map: 'strip' -%}
{%- endif -%}

{%- comment -%} collect items matching the requested types {%- endcomment -%}
{%- assign matched = "" | split: "|" -%}
{%- for item in principles_data.items -%}
  {%- for want_type in sel_types -%}
    {%- if item.type == want_type -%}
      {%- assign matched = matched | push: item -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}
{%- endfor -%}

{%- comment -%} normalize src into `wants` array if needed {%- endcomment -%}
{%- if src and src[0] == nil -%}
  {%- assign s = src | to_s | strip -%}
  {%- if s contains '[' and s contains ']' -%}
    {%- assign s = s | remove:'[' | remove:']' | remove:'"' | remove:"'" | strip -%}
  {%- endif -%}
  {%- if s contains ',' -%}
    {%- assign wants = s | split:',' | map:'strip' -%}
  {%- else -%}
    {%- assign wants = s | split:'\n' | map:'strip' -%}
  {%- endif -%}
{%- else -%}
  {%- assign wants = src -%}
{%- endif -%}

{%- if sel_types and sel_types.size > 0 -%}
   {%- assign list_section = { "data": { "label": "Principles", "items": matched } } -%}

{%- elsif wants and wants.size > 0 -%}
  {%- assign list_section = 
      { "data": {
        "label": "Principles",
        "items": "" | split: "|"
      } }
  -%}
{%- endif -%}

{% include sections/list.html section=list_section %}