{%- comment -%}
Render principles referenced by a page or section.

Inputs accepted:
- include.principles (array or CSV/JSON-like string)
- section.data.principles
- page.principles

Also supports selecting a full type via:
- include.types or section.data.types (maps into principle_types)

Outputs:
- Calls sections/list.html with section object: { label, items }
{%- endcomment -%}

{%- assign src = include.principles | default: section.data.principles | default: page.principles -%}
{%- assign section_types = include.types | default: section.data.types | default: page.principles_types -%}
{%- assign data = site.data.sections.principles -%}
{%- assign matched = "" | split: "|" -%}

{%- if section_types -%}
  {%- assign type_block = data.principle_types[section_types] -%}
  {%- assign label_val = type_block.label | default: "Principles" -%}
  {%- assign items_val = type_block.items -%}
  {%- assign list_section = type_block | merge: { "label": label_val, "items": items_val } -%}

{%- elsif src -%}
  {%- comment -%} normalize src into an array `wants` {%- endcomment -%}
  {%- if src[0] != nil -%}
    {%- assign wants = src -%}
  {%- else -%}
    {%- assign s = src | to_s | strip -%}
    {%- if s contains '[' and s contains ']' -%}
      {%- assign s = s | remove:'[' | remove:']' | remove:'"' | remove:"'" | strip -%}
    {%- endif -%}
    {%- if s contains ',' -%}
      {%- assign wants = s | split:',' | map:'strip' -%}
    {%- else -%}
      {%- assign wants = s | split:'\n' | map:'strip' -%}
    {%- endif -%}
  {%- endif -%}

  {%- comment -%} match requested ids against the flat items array {%- endcomment -%}
  {%- for item in data.items -%}
    {%- for want in wants -%}
      {%- assign want_norm = want | to_s | slugify -%}
      {%- if item.id == want or item.id == want_norm -%}
        {%- assign matched = matched | push: item -%}
        {%- break -%}
      {%- endif -%}
    {%- endfor -%}
  {%- endfor -%}

  {%- assign list_section = 
      {
        "label": "Principles",
        "items": matched
      }
  -%}

{%- else -%}
  {%- assign list_section = 
      {
        "label": "Principles",
        "items": "" | split: "|"
      }
  -%}
{%- endif -%}

{% include sections/list.html section=list_section %}