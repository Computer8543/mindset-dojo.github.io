{%- comment -%}
Principles include — simple, predictable, fits list.html.

Inputs (from dispatch):
- section.data.principles  => ARRAY of ids (optional)
- section.data.principle_type => STRING (optional)

Data source:
- include.page_data (when dispatch supplies site.data as page_data),
  otherwise fallback to site.data.sections.principles

Behavior:
- Start from full dataset (principles.items)
- If principle_type present → keep only items with that type (string equality)
- If principles (array) present → return items in the order of that array
- Pass { data: { label, items } } to sections/list.html
{%- endcomment -%}

{%- assign section_data = include.page_data | default: site.data.sections.principles -%}
{%- assign src = section.data.principles -%}
{%- assign sel_type = section.data.principle_type -%}

{%- comment -%} defensive: if sel_type accidentally an array, take first element {%- endcomment -%}
{%- if sel_type and sel_type[0] != nil -%}
  {%- assign sel_type = sel_type[0] -%}
{%- endif -%}

{%- assign items = section_data.items | default: "" | split: "|" -%}

{%- comment -%} apply type filter if provided (strict equality) {%- endcomment -%}
{%- if sel_type and sel_type != "" -%}
  {%- assign by_type = "" | split: "|" -%}
  {%- for it in items -%}
    {%- if it.type == sel_type -%}
      {%- assign by_type = by_type | push: it -%}
    {%- endif -%}
  {%- endfor -%}
  {%- assign items = by_type -%}
{%- endif -%}

{%- comment -%} if src is an array, select items in its order; otherwise keep current items {%- endcomment -%}
{%- if src and src[0] != nil -%}
  {%- assign wants = src -%}
  {%- assign final_items = "" | split: "|" -%}
  {%- for want in wants -%}
    {%- assign want_val = want -%}
    {%- if want_val[0] != nil -%}
      {%- assign want_val = want_val[0] -%}
    {%- endif -%}
    {%- assign want_str = want_val | to_s -%}
    {%- for it in items -%}
      {%- assign it_id = it.id -%}
      {%- if it_id[0] != nil -%}
        {%- assign it_id = it_id[0] -%}
      {%- endif -%}
      {%- if it_id | to_s == want_str -%}
        {%- assign final_items = final_items | push: it -%}
        {%- break -%}
      {%- endif -%}
    {%- endfor -%}
  {%- endfor -%}
{%- else -%}
  {%- assign final_items = items -%}
{%- endif -%}

{%- comment -%} prepare section object expected by list.html (section.data.*) {%- endcomment -%}
{%- assign list_section = { "data": { "label": "Related Principles", "items": final_items } } -%}

{% include sections/list.html section=list_section %}
