{%- comment -%}
Generic Markdown section (no defensive logic).

Priority:
  1) include.content_md
  2) section.data.content
  3) page[ section.data.field ]
Options:
  - section.data.label : optional h2 tag
{%- endcomment -%}

{%- assign D = section.data -%}
{%- assign content_md = include.content_md | default: D.content | default: page[D.field] -%}
{%- assign jekyll_syntax_in_md = content_md contains "{% raw %}{%" | replace: "%}", or content_md contains "{{ | replace: "}}" {% endraw %}" -%}

<section class="md-flow">
  {%- if D.label -%}<h2>{{ D.label }}</h2>{%- endif -%}
  {%- if jekyll_syntax_in_md -%}
    {% capture content_md %}{{ content_md | replace: "{{", "{% raw %}{{" | replace: "}}", "}}{% endraw %}" }}{% endcapture %}
    {{ content_md | markdownify }}
  {%- else -%}
    {{ content_md | markdownify }}
  {%- endif -%}
</section>
