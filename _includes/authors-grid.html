{%- comment -%}
authors-grid.html
──────────────────
Purpose:
  Render a grid of active authors. If `leadership_flow` is provided, wrap the
  grid in `<section class="md-flow">` and use `leadership_flow.label` as <h2>.

Parameters:
  - leadership_flow (optional): map with at least `label`
  - profiles? (optional): override data source
  - avatars?  (optional): override data source

Data Source (defaults):
  site.data.authors.profiles
  site.data.authors.avatars

Usage:
  {% include authors-grid.html %}  <!-- grid only -->
  {% include authors-grid.html leadership_flow=context.leadership_flow %}
{%- endcomment -%}

{%- assign profiles = include.profiles | default: site.data.authors.profiles -%}
{%- assign avatars  = include.avatars  | default: site.data.authors.avatars  -%}
{%- assign entries  = "" | split: "|" -%}

{%- assign has_wrapper = include.leadership_flow -%}
{%- if has_wrapper -%}
<section class="md-flow">
  {%- if include.leadership_flow.label -%}
    <h2>{{ include.leadership_flow.label }}</h2>
  {%- endif -%}
</section>
{%- endif -%}

<div class="md-authors">
  {%- comment -%} 1) Build sortable list of active authors {%- endcomment -%}
  {% for pair in profiles %}
    {% assign key = pair[0] %}
    {% assign member = pair[1] %}
    {% if member.active %}
      {%- assign neg_belt = member.belt_level | times: -1 | plus: 1000 | prepend: "0000" | slice: -4, 4 -%}
      {% capture entry %}{{ neg_belt }}|{{ member.join_date }}|{{ key }}{% endcapture %}
      {% assign entries = entries | push: entry %}
    {% endif %}
  {% endfor %}

  {%- comment -%} 2) Sort by belt_level DESC, then join_date ASC {%- endcomment -%}
  {% assign sorted_entries = entries | sort %}

  {%- comment -%} 3) Render each profile card {%- endcomment -%}
  {% for entry in sorted_entries %}
    {% assign parts  = entry | split: "|" %}
    {% assign key    = parts[2] %}
    {% assign member = profiles[key] %}
    {% assign avatar = avatars[key] %}
    {% include member.html member=member avatar=avatar %}
  {% endfor %}
</div>
