---
layout: default
---

{%- comment -%}
Post layout. Assumes default.html prints the H1 (title) as in your provided default.
This template will render (top → bottom):
 - title (rendered by default.html already)
 - post body ({{ content }})
 - image (rendered here at the bottom)
Front matter supported:
 - title, date, author, tags, excerpt, image (raw base64 OR data URI OR path), image_alt,
   optional: image_mime (e.g. "image/png" or "image/jpeg") if using raw base64.
{%- endcomment -%}

<article class="post-article">
  <header class="post-header">
    <p class="post-meta">
      By {{ page.author | default: site.author }} — {{ page.date | date: "%B %-d, %Y" }}
    </p>

    {% if page.excerpt %}
      <p class="post-excerpt">{{ page.excerpt }}</p>
    {% endif %}
  </header>

  <div class="post-body">
    {{ content }}
  </div>

  {%- comment -%}
  IMAGE RENDERING (bottom of article)
  Handling cases:
    1) page.image is a full data: URI (contains "data:")
    2) page.image contains "base64," already (treat as data URI or partial)
    3) page.image looks like a path (contains "/" or ".") -> treat as asset path
    4) page.image is raw base64 (no indicator) -> prepend data:<mime>;base64,
       using page.image_mime or defaulting to image/jpeg
  {%- endcomment -%}

  {% if page.image %}
    {% assign raw_img = page.image | strip %}

    {% if raw_img contains "data:" %}
      {% assign img_src = raw_img %}
    {% elsif raw_img contains "base64," %}
      {%- comment -%} Already contains base64 marker but may be missing "data:...;" prefix; try to use as-is. {%- endcomment -%}
      {% assign img_src = raw_img %}
    {% elsif raw_img contains "/" or raw_img contains "." %}
      {%- comment -%} Treat as path / URL. Use relative_url so baseurl works. {%- endcomment -%}
      {% assign img_src = raw_img | relative_url %}
    {% else %}
      {%- comment -%} Treat as raw base64; prepend MIME type. {%- endcomment -%}
      {% assign img_mime = page.image_mime | default: "image/jpeg" %}
      {% assign img_src = "data:" | append: img_mime | append: ";base64," | append: raw_img %}
    {% endif %}

    <figure class="post-image" role="img" aria-label="{{ page.image_alt | default: page.title }}">
      <img
        src="{{ '/insight/' | append: img_src }}"
        alt="{{ page.image_alt | default: page.title | escape }}"
        loading="lazy"
        class="post-image__img"
      />
      {% if page.image_alt %}
        <figcaption class="post-image__caption">{{ page.image_alt }}</figcaption>
      {% endif %}
    </figure>
  {% endif %}

  {% if page.tags %}
    <footer class="post-tags">
      Tags:
      {% for tag in page.tags %}
        {% assign tag_slug = tag | slugify %}
          <a href="{{ '/insight/' | append: 'tag-' | append: tag_slug | append: '/' | relative_url }}" class="tag">{{ tag }}</a>
        {% unless forloop.last %}, {% endunless %}
      {% endfor %}
    </footer>
  {% endif %}
</article>
