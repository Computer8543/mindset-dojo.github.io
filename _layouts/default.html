{%- comment -%} _layouts/default.html {%- endcomment -%}
<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">
{% include head.html %}
<body id="{{ page.css_id }}">
  {% include header.html %}

  <main aria-label="Content">
    {%- assign data    = site.data[page.data_key] -%}
    {%- assign mission = site.data.mission -%}

    {%- comment -%}
      H1 precedence:
        page.h1 → page.mantra → data.mantra → mission.mantra → site.title
      Mark precedence:
        page.h1_mark → page.mantra_mark → data.mantra_mark → mission.mantra_mark
    {%- endcomment -%}
    {%- assign base_h1     = page.h1
                               | default: page.mantra
                               | default: data.mantra
                               | default: mission.mantra
                               | default: site.title -%}
    {%- assign h1_mark_val = page.h1_mark
                               | default: page.mantra_mark
                               | default: data.mantra_mark
                               | default: mission.mantra_mark -%}

    {%- if base_h1 -%}
      {%- if h1_mark_val -%}
        {%- capture marked -%}<mark>{{ h1_mark_val }}</mark>{%- endcapture -%}
        {%- assign h1_rendered = base_h1 | replace_first: h1_mark_val, marked -%}
      {%- else -%}
        {%- assign h1_rendered = base_h1 -%}
      {%- endif -%}
      <h1>{{ h1_rendered }}</h1>
      <hr>
    {%- endif -%}

    {{ content }}
  </main>

  {% include footer.html %}
</body>
</html>
